<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì‹ë‹¨ ì…ë ¥</title>
<style>
  :root{--gap:12px}
  body{font-family:sans-serif;line-height:1.6;padding:24px;max-width:960px;margin:auto}
  fieldset{border:1px solid #ddd;border-radius:10px;padding:16px;margin:var(--gap) 0}
  label{display:inline-flex;align-items:center;gap:8px;margin-right:12px}
  input,button,select{padding:8px 10px}
  input[type="number"]{width:120px}
  table{border-collapse:collapse;width:100%;margin-top:var(--gap)}
  th,td{border:1px solid #e5e5e5;padding:10px;text-align:left}
  td.right,th.right{text-align:right}
  .row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}
  .danger{color:#b00020}
  .muted{color:#666}
  .actions{display:flex;gap:10px;margin-top:var(--gap)}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #ddd;margin-right:8px}
</style>
</head>
<body>
<h1>ì‹ë‹¨ ì…ë ¥</h1>

<!-- ğŸ‘‰ ê¶Œì¥ ì¹¼ë¡œë¦¬ ê³„ì‚° (í‚¤/ëª¸ë¬´ê²Œ + ì„ íƒ: ì„±ë³„/ë‚˜ì´/í™œë™ëŸ‰) -->
<fieldset>
  <legend>ê¶Œì¥ ì¹¼ë¡œë¦¬ ê³„ì‚°</legend>
  <div class="row">
    <label>í‚¤(cm) <input id="height" type="number" placeholder="ì˜ˆ: 173" min="50" max="250" /></label>
    <label>ëª¸ë¬´ê²Œ(kg) <input id="weight" type="number" placeholder="ì˜ˆ: 70" min="20" max="300" /></label>

    <label>ì„±ë³„
      <select id="sex">
        <option value="male" selected>ë‚¨ì„±</option>
        <option value="female">ì—¬ì„±</option>
      </select>
    </label>

    <label>ë‚˜ì´
      <input id="age" type="number" value="21" min="10" max="99" />
    </label>

    <label>í™œë™ëŸ‰
      <select id="activity">
        <option value="1.2">ë§¤ìš° ë‚®ìŒ(1.2)</option>
        <option value="1.375" selected>ê°€ë²¼ì›€(1.375)</option>
        <option value="1.55">ë³´í†µ(1.55)</option>
        <option value="1.725">ë†’ìŒ(1.725)</option>
        <option value="1.9">ë§¤ìš° ë†’ìŒ(1.9)</option>
      </select>
    </label>

    <button id="calcGoal">ê¶Œì¥ ì¹¼ë¡œë¦¬ ê³„ì‚°</button>
  </div>
  <div id="goalInfo" class="muted" style="margin-top:6px;"></div>
</fieldset>

<!-- í•˜ë£¨ ëª©í‘œ ì¹¼ë¡œë¦¬(ìë™ ì±„ì›€ ëŒ€ìƒ) -->
<fieldset>
  <legend>í•˜ë£¨ ëª©í‘œ (kcal)</legend>
  <div class="row">
    <label>ëª©í‘œ: <input id="goal" type="number" value="2000" min="0" step="10" /></label>
    <span class="muted">ì˜ˆ) 173cm/70kg ê°€ë²¼ìš´ í™œë™ì´ë©´ ì•½ 2300kcal ê·¼ì²˜</span>
  </div>
</fieldset>

<!-- í•­ëª© ì¶”ê°€ -->
<fieldset>
  <legend>í•­ëª© ì¶”ê°€</legend>
  <div class="row">
    <label>ìŒì‹ëª… <input id="name" placeholder="ì˜ˆ: ë°”ë‚˜ë‚˜" /></label>
    <label>1íšŒ ì¹¼ë¡œë¦¬(kcal) <input id="kcal" type="number" placeholder="ì˜ˆ: 89" /></label>
    <label>ê°œìˆ˜ <input id="qty" type="number" value="1" min="1" /></label>
    <button id="add">ì¶”ê°€</button>
    <button id="preset">ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>
  <div id="err" class="danger"></div>
</fieldset>

<!-- ëª©ë¡/í•©ê³„ -->
<table id="tbl">
  <thead>
    <tr><th>#</th><th>ìŒì‹</th><th class="right">1íšŒ(kcal)</th><th class="right">ê°œìˆ˜</th><th class="right">í•©ê³„(kcal)</th><th>ì‚­ì œ</th></tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr><th colspan="4" class="right">ì´í•©</th><th id="total" class="right">0</th><th></th></tr>
  </tfoot>
</table>

<div class="actions">
  <button id="finish">ê²°ê³¼ ë³´ê¸°</button>
  <button id="clear">ëª¨ë‘ ë¹„ìš°ê¸°</button>
</div>

<script>
const $ = s => document.querySelector(s);
const tbody = $('#tbl tbody');
const totalEl = $('#total');
const err = $('#err');
const goalInfo = $('#goalInfo');
let items = []; // {name, kcal, qty}

/* ===== ê¶Œì¥ ì¹¼ë¡œë¦¬ ê³„ì‚° (Mifflin-St Jeor + í™œë™ê³„ìˆ˜) ===== */
function calcRecommendedGoal(){
  const h = Number($('#height').value);
  const w = Number($('#weight').value);
  const age = Number($('#age').value || 21);
  const sex = $('#sex').value;               // 'male' | 'female'
  const af  = Number($('#activity').value);  // í™œë™ê³„ìˆ˜

  if(!h || !w){ goalInfo.textContent = 'í‚¤ì™€ ëª¸ë¬´ê²Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'; return; }

  // BMR
  let bmr;
  if(sex === 'male'){
    bmr = 10*w + 6.25*h - 5*age + 5;
  }else{
    bmr = 10*w + 6.25*h - 5*age - 161;
  }
  const tdee = Math.round(bmr * af);

  // í•˜ë£¨ ëª©í‘œì— ìë™ ë°˜ì˜
  $('#goal').value = tdee;

  goalInfo.innerHTML =
    `<span class="pill">BMR â‰ˆ ${Math.round(bmr)} kcal</span>` +
    `<span class="pill">í™œë™ê³„ìˆ˜ Ã— ${af}</span>` +
    `<span class="pill"><strong>ê¶Œì¥ ì„­ì·¨ â‰ˆ ${tdee} kcal</strong></span>`;
}
$('#calcGoal').addEventListener('click', calcRecommendedGoal);

/* ===== ì‹ë‹¨ ëª©ë¡ ë Œë”ë§ ===== */
function render(){
  tbody.innerHTML = '';
  let total = 0;
  items.forEach((it, i) => {
    const sum = it.kcal * it.qty;
    total += sum;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${it.name}</td>
      <td class="right">${it.kcal.toLocaleString()}</td>
      <td class="right">
         <input type="number" value="${it.qty}" min="1" style="width:70px" data-i="${i}" class="qty">
      </td>
      <td class="right">${sum.toLocaleString()}</td>
      <td><button class="del" data-i="${i}">X</button></td>
    `;
    tbody.appendChild(tr);
  });
  totalEl.textContent = total.toLocaleString();
}

function addItem(){
  err.textContent = '';
  const name = $('#name').value.trim();
  const kcal = Number($('#kcal').value);
  const qty  = Number($('#qty').value);
  if(!name || !kcal || !qty || kcal<0 || qty<1){
    err.textContent = 'ì´ë¦„/ì¹¼ë¡œë¦¬/ê°œìˆ˜ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.';
    return;
  }
  items.push({name, kcal, qty});
  $('#name').value = '';
  $('#kcal').value = '';
  $('#qty').value = 1;
  render();
}
$('#add').addEventListener('click', addItem);

// ìˆ˜ëŸ‰ ë³€ê²½/ì‚­ì œ ìœ„ì„
tbody.addEventListener('input', (e) => {
  if(e.target.classList.contains('qty')){
    const i = Number(e.target.dataset.i);
    const v = Math.max(1, Number(e.target.value)||1);
    items[i].qty = v; render();
  }
});
tbody.addEventListener('click', (e) => {
  if(e.target.classList.contains('del')){
    const i = Number(e.target.dataset.i);
    items.splice(i,1); render();
  }
});

// ì˜ˆì‹œ í”„ë¦¬ì…‹
$('#preset').addEventListener('click', () => {
  items = [
    {name:'ì˜¤íŠ¸ë°€', kcal:300, qty:1},
    {name:'ìš°ìœ ', kcal:130, qty:1},
    {name:'ë°”ë‚˜ë‚˜', kcal:89, qty:1},
    {name:'ë‹­ê°€ìŠ´ì‚´', kcal:165, qty:2},
    {name:'ë°¥', kcal:300, qty:2},
    {name:'ê¹€ì¹˜', kcal:30, qty:1},
    {name:'ìš”ê±°íŠ¸', kcal:100, qty:1},
    {name:'ì•„ëª¬ë“œ', kcal:150, qty:1},
    {name:'ì—°ì–´', kcal:208, qty:2},
    {name:'ìƒëŸ¬ë“œ', kcal:120, qty:1},
    {name:'ì‚¶ì€ ê³„ë€', kcal:78, qty:1},
  ];
  render();
});

// ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
$('#finish').addEventListener('click', () => {
  const goal = Math.max(0, Number($('#goal').value)||0);
  const q = new URLSearchParams();
  q.set('goal', String(goal));
  q.set('data', encodeURIComponent(JSON.stringify(items)));
  location.href = './result.html?' + q.toString();
});

// ë¹„ìš°ê¸°
$('#clear').addEventListener('click', () => { items = []; render(); });

render();
</script>
</body>
</html>
